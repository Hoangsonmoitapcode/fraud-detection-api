# ğŸš‚ Railway Production Setup Guide

## ğŸ¯ Má»¥c tiÃªu: Deploy API vá»›i má»i thá»© Ä‘Ã£ cÃ i sáºµn trong 30 giÃ¢y

---

## ğŸ“‹ Prerequisites

### âœ… ÄÃ£ hoÃ n thÃ nh:
- [x] GitHub repository vá»›i source code
- [x] GitHub Actions workflow tá»‘i Æ°u
- [x] Docker image production-ready
- [x] Loáº¡i bá» files lá»›n khá»i build

### ğŸ”„ Cáº§n lÃ m:
- [ ] Trigger GitHub Actions build
- [ ] Táº¡o Railway project tá»« Docker image
- [ ] Configure environment variables
- [ ] Test deployment

---

## ğŸš€ BÆ°á»›c 1: Build Docker Image

### Option A: Sá»­ dá»¥ng script tá»± Ä‘á»™ng (RECOMMENDED)
```powershell
./deploy-production.ps1
```

### Option B: Manual trigger
```powershell
git add .
git commit -m "deploy: Production ready with pre-installed dependencies"
git push origin main
```

### ğŸ“Š Build Progress:
- **Time**: 5-8 phÃºt (láº§n Ä‘áº§u)
- **Size**: ~3GB (heavy but complete)
- **Includes**: All dependencies + ML models + pre-compiled code

---

## ğŸš‚ BÆ°á»›c 2: Setup Railway Project

### 1. **Truy cáº­p Railway Dashboard**
```
https://railway.app/dashboard
```

### 2. **Táº¡o Project Má»›i**
- Click **"New Project"**
- Select **"Deploy from Docker Image"**

### 3. **Configure Docker Image**
```
Image URL: ghcr.io/hoangsonmoitapcode/fraud-detection-api:latest
Port: 8000
```

### 4. **Set Environment Variables**
```env
DATABASE_URL=postgresql://username:password@host:port/database
PORT=8000
ENVIRONMENT=production
PYTHONPATH=/app
PYTHONUNBUFFERED=1
```

### 5. **Deploy**
- Click **"Deploy"**
- Deployment time: **30-60 seconds** âš¡

---

## ğŸ”§ Environment Variables Chi Tiáº¿t

### ğŸ”´ Required Variables:
```env
DATABASE_URL=postgresql://user:pass@hostname:5432/dbname
```

### ğŸŸ¡ Optional Variables:
```env
PORT=8000                    # Railway tá»± Ä‘á»™ng set
ENVIRONMENT=production       # App environment
PYTHONPATH=/app             # Python module path
PYTHONUNBUFFERED=1          # Real-time logs
```

### ğŸ”µ Auto-generated by Railway:
```env
RAILWAY_ENVIRONMENT=production
RAILWAY_PROJECT_NAME=fraud-detection-api
RAILWAY_SERVICE_NAME=web
```

---

## ğŸ¯ Deployment Timeline

| Step | Time | Description |
|------|------|-------------|
| **GitHub Actions** | 5-8min | Build heavy Docker image (one-time) |
| **Railway Pull** | 30s | Download pre-built image |
| **Railway Start** | 30s | Start application |
| **Total** | **~1min** | After initial build âš¡ |

---

## ğŸ” Verification Steps

### 1. **Check Deployment Status**
- Railway dashboard shows **"Running"**
- Logs show successful startup

### 2. **Test Health Endpoint**
```bash
curl https://your-app.railway.app/health
```

### 3. **Test Main Endpoint**
```bash
curl https://your-app.railway.app/
```

### 4. **Test API Documentation**
```
https://your-app.railway.app/docs
```

---

## ğŸš¨ Troubleshooting

### âŒ "Image not found"
- **Cause**: GitHub Actions build chÆ°a hoÃ n thÃ nh
- **Solution**: Äá»£i build complete, check GitHub Actions

### âŒ "Container failed to start"
- **Cause**: Environment variables thiáº¿u
- **Solution**: ThÃªm DATABASE_URL vÃ  cÃ¡c env vars cáº§n thiáº¿t

### âŒ "Build timeout"
- **Cause**: Railway cá»‘ build tá»« source
- **Solution**: Äáº£m báº£o sá»­ dá»¥ng "Deploy from Docker Image"

### âŒ "Port binding failed"
- **Cause**: Port config sai
- **Solution**: Äáº·t PORT=8000 hoáº·c Ä‘á»ƒ Railway auto-detect

---

## ğŸ”„ Update Workflow

### Khi cáº§n update code:
1. **Edit source code**
2. **Commit & push** 
3. **GitHub Actions auto-build** (náº¿u cÃ³ thay Ä‘á»•i quan trá»ng)
4. **Railway auto-redeploy** (30 giÃ¢y)

### Khi cáº§n force rebuild:
```powershell
./deploy-production.ps1 -ForceRebuild
```

---

## ğŸ“Š Performance Benefits

### Before (Railway Build from Source):
- âŒ Build time: 5-10 minutes
- âŒ Frequent timeouts
- âŒ Inconsistent environments
- âŒ Dependency download every time

### After (Pre-built Docker Image):
- âœ… Deploy time: 30-60 seconds
- âœ… No build timeouts
- âœ… Consistent production environment
- âœ… All dependencies pre-installed
- âœ… ML models pre-cached
- âœ… Code pre-compiled

---

## ğŸ‰ Success Criteria

### âœ… Deployment Successful When:
- [ ] Railway shows "Running" status
- [ ] Health check returns 200 OK
- [ ] API docs accessible at `/docs`
- [ ] Database connection working
- [ ] ML models loading correctly
- [ ] Response time < 2 seconds

---

## ğŸ”— Quick Links

- **GitHub Actions**: https://github.com/hoangsonmoitapcode/fraud-detection-api/actions
- **Docker Image**: ghcr.io/hoangsonmoitapcode/fraud-detection-api:latest
- **Railway Dashboard**: https://railway.app/dashboard
- **API Documentation**: https://your-app.railway.app/docs

---

## ğŸ’¡ Pro Tips

1. **Monitor first deployment** Ä‘á»ƒ Ä‘áº£m báº£o má»i thá»© hoáº¡t Ä‘á»™ng
2. **Bookmark Railway dashboard** Ä‘á»ƒ dá»… access
3. **Save DATABASE_URL** á»Ÿ nÆ¡i an toÃ n
4. **Test API endpoints** sau má»—i deployment
5. **Check logs** náº¿u cÃ³ váº¥n Ä‘á»
