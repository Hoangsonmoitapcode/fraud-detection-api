# 🚂 Railway Production Setup Guide

## 🎯 Mục tiêu: Deploy API với mọi thứ đã cài sẵn trong 30 giây

---

## 📋 Prerequisites

### ✅ Đã hoàn thành:
- [x] GitHub repository với source code
- [x] GitHub Actions workflow tối ưu
- [x] Docker image production-ready
- [x] Loại bỏ files lớn khỏi build

### 🔄 Cần làm:
- [ ] Trigger GitHub Actions build
- [ ] Tạo Railway project từ Docker image
- [ ] Configure environment variables
- [ ] Test deployment

---

## 🚀 Bước 1: Build Docker Image

### Option A: Sử dụng script tự động (RECOMMENDED)
```powershell
./deploy-production.ps1
```

### Option B: Manual trigger
```powershell
git add .
git commit -m "deploy: Production ready with pre-installed dependencies"
git push origin main
```

### 📊 Build Progress:
- **Time**: 5-8 phút (lần đầu)
- **Size**: ~3GB (heavy but complete)
- **Includes**: All dependencies + ML models + pre-compiled code

---

## 🚂 Bước 2: Setup Railway Project

### 1. **Truy cập Railway Dashboard**
```
https://railway.app/dashboard
```

### 2. **Tạo Project Mới**
- Click **"New Project"**
- Select **"Deploy from Docker Image"**

### 3. **Configure Docker Image**
```
Image URL: ghcr.io/hoangsonmoitapcode/fraud-detection-api:latest
Port: 8000
```

### 4. **Set Environment Variables**
```env
DATABASE_URL=postgresql://username:password@host:port/database
PORT=8000
ENVIRONMENT=production
PYTHONPATH=/app
PYTHONUNBUFFERED=1
```

### 5. **Deploy**
- Click **"Deploy"**
- Deployment time: **30-60 seconds** ⚡

---

## 🔧 Environment Variables Chi Tiết

### 🔴 Required Variables:
```env
DATABASE_URL=postgresql://user:pass@hostname:5432/dbname
```

### 🟡 Optional Variables:
```env
PORT=8000                    # Railway tự động set
ENVIRONMENT=production       # App environment
PYTHONPATH=/app             # Python module path
PYTHONUNBUFFERED=1          # Real-time logs
```

### 🔵 Auto-generated by Railway:
```env
RAILWAY_ENVIRONMENT=production
RAILWAY_PROJECT_NAME=fraud-detection-api
RAILWAY_SERVICE_NAME=web
```

---

## 🎯 Deployment Timeline

| Step | Time | Description |
|------|------|-------------|
| **GitHub Actions** | 5-8min | Build heavy Docker image (one-time) |
| **Railway Pull** | 30s | Download pre-built image |
| **Railway Start** | 30s | Start application |
| **Total** | **~1min** | After initial build ⚡ |

---

## 🔍 Verification Steps

### 1. **Check Deployment Status**
- Railway dashboard shows **"Running"**
- Logs show successful startup

### 2. **Test Health Endpoint**
```bash
curl https://your-app.railway.app/health
```

### 3. **Test Main Endpoint**
```bash
curl https://your-app.railway.app/
```

### 4. **Test API Documentation**
```
https://your-app.railway.app/docs
```

---

## 🚨 Troubleshooting

### ❌ "Image not found"
- **Cause**: GitHub Actions build chưa hoàn thành
- **Solution**: Đợi build complete, check GitHub Actions

### ❌ "Container failed to start"
- **Cause**: Environment variables thiếu
- **Solution**: Thêm DATABASE_URL và các env vars cần thiết

### ❌ "Build timeout"
- **Cause**: Railway cố build từ source
- **Solution**: Đảm bảo sử dụng "Deploy from Docker Image"

### ❌ "Port binding failed"
- **Cause**: Port config sai
- **Solution**: Đặt PORT=8000 hoặc để Railway auto-detect

---

## 🔄 Update Workflow

### Khi cần update code:
1. **Edit source code**
2. **Commit & push** 
3. **GitHub Actions auto-build** (nếu có thay đổi quan trọng)
4. **Railway auto-redeploy** (30 giây)

### Khi cần force rebuild:
```powershell
./deploy-production.ps1 -ForceRebuild
```

---

## 📊 Performance Benefits

### Before (Railway Build from Source):
- ❌ Build time: 5-10 minutes
- ❌ Frequent timeouts
- ❌ Inconsistent environments
- ❌ Dependency download every time

### After (Pre-built Docker Image):
- ✅ Deploy time: 30-60 seconds
- ✅ No build timeouts
- ✅ Consistent production environment
- ✅ All dependencies pre-installed
- ✅ ML models pre-cached
- ✅ Code pre-compiled

---

## 🎉 Success Criteria

### ✅ Deployment Successful When:
- [ ] Railway shows "Running" status
- [ ] Health check returns 200 OK
- [ ] API docs accessible at `/docs`
- [ ] Database connection working
- [ ] ML models loading correctly
- [ ] Response time < 2 seconds

---

## 🔗 Quick Links

- **GitHub Actions**: https://github.com/hoangsonmoitapcode/fraud-detection-api/actions
- **Docker Image**: ghcr.io/hoangsonmoitapcode/fraud-detection-api:latest
- **Railway Dashboard**: https://railway.app/dashboard
- **API Documentation**: https://your-app.railway.app/docs

---

## 💡 Pro Tips

1. **Monitor first deployment** để đảm bảo mọi thứ hoạt động
2. **Bookmark Railway dashboard** để dễ access
3. **Save DATABASE_URL** ở nơi an toàn
4. **Test API endpoints** sau mỗi deployment
5. **Check logs** nếu có vấn đề
